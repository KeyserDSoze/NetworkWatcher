<UserControl x:Class="NetworkWatcherExtension.NetworkWatcherToolWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
             Background="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBackgroundKey}}"
             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Name="NetworkWatcherWindow">
    <UserControl.Resources>
        <!-- Custom ListView Item Style with darker, more VS-like colors -->
        <Style x:Key="ListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                Padding="4,2">
                            <GridViewRowPresenter Content="{TemplateBinding Content}"
                                                Columns="{TemplateBinding GridView.ColumnCollection}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <!-- Hover state (non-selected) -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                    <Condition Property="IsSelected" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="Background" Value="#2A2D2E"/>
                            </MultiTrigger>

                            <!-- Selected state (with focus) -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True"/>
                                    <Condition Property="Selector.IsSelectionActive" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="Background" Value="#094771"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </MultiTrigger>

                            <!-- Selected state (without focus - IMPORTANT: keep same color!) -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True"/>
                                    <Condition Property="Selector.IsSelectionActive" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="Background" Value="#094771"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </MultiTrigger>

                            <!-- Selected + Hover state -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="Background" Value="#1C97EA"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style for search TextBox with darker colors -->
        <Style x:Key="SearchBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#252526"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <!-- Style for detail TextBox with visible inactive selection -->
        <Style x:Key="DetailTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <!-- Make selection visible even when TextBox doesn't have focus -->
            <Setter Property="SelectionBrush" Value="#264F78"/>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="2*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Background="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarGradientBeginKey}}" 
                BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}" 
                BorderThickness="0,0,0,1" Padding="5">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="StartButton" Content="Start Proxy" Width="100" Margin="0,0,5,0" Click="StartButton_Click"/>
                <Button x:Name="StopButton" Content="Stop Proxy" Width="100" Margin="0,0,5,0" Click="StopButton_Click" IsEnabled="False"/>
                <Button x:Name="ClearButton" Content="Clear" Width="80" Margin="10,0,5,0" Click="ClearButton_Click"/>
                <TextBlock Text="Status:" VerticalAlignment="Center" Margin="10,0,5,0" 
                           Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                <TextBlock x:Name="StatusText" Text="Stopped" VerticalAlignment="Center" FontWeight="Bold"
                           Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
            </StackPanel>
        </Border>

        <!-- Filters -->
        <Border Grid.Row="1" Background="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBackgroundKey}}" 
                BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}" 
                BorderThickness="0,0,0,1" Padding="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="Domain/URL:" VerticalAlignment="Center" Margin="0,0,5,0"
                           Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                <TextBox Grid.Column="1" x:Name="DomainFilterBox" VerticalAlignment="Center" TextChanged="FilterChanged"/>

                <TextBlock Grid.Column="2" Text="Protocol:" VerticalAlignment="Center" Margin="10,0,5,0"
                           Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                <ComboBox Grid.Column="3" x:Name="ProtocolFilterBox" VerticalAlignment="Center" SelectionChanged="FilterChanged">
                    <ComboBoxItem Content="All" IsSelected="True"/>
                    <ComboBoxItem Content="HTTP"/>
                    <ComboBoxItem Content="HTTPS"/>
                </ComboBox>
            </Grid>
        </Border>

        <!-- Request List -->
        <Border Grid.Row="2" Background="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBackgroundKey}}"
                BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}" BorderThickness="0,0,0,1">
            <ListView x:Name="RequestListView" SelectionChanged="RequestListView_SelectionChanged"
                      Background="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBackgroundKey}}"
                      Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"
                      ItemContainerStyle="{StaticResource ListViewItemStyle}">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Time" Width="80" DisplayMemberBinding="{Binding Time}"/>
                        <GridViewColumn Header="Method" Width="70" DisplayMemberBinding="{Binding Method}"/>
                        <GridViewColumn Header="Protocol" Width="70" DisplayMemberBinding="{Binding Protocol}"/>
                        <GridViewColumn Header="URL" Width="400" DisplayMemberBinding="{Binding Url}"/>
                        <GridViewColumn Header="Status" Width="60" DisplayMemberBinding="{Binding Status}"/>
                    </GridView>
                </ListView.View>
            </ListView>
        </Border>

        <GridSplitter Grid.Row="3" HorizontalAlignment="Stretch" 
                      Background="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}"/>

        <!-- Details View -->
        <TabControl Grid.Row="4" x:Name="DetailsTabControl"
                    Background="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBackgroundKey}}"
                    Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}">
            <TabItem Header="Request Headers">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="5">
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="#999999"/>
                        <TextBox x:Name="RequestHeadersSearchBox" Width="200" Style="{StaticResource SearchBoxStyle}" TextChanged="SearchBox_TextChanged"/>
                        <TextBlock x:Name="RequestHeadersSearchResult" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="#999999"/>
                    </StackPanel>
                    <TextBox x:Name="RequestHeadersBox" Style="{StaticResource DetailTextBoxStyle}"/>
                </DockPanel>
            </TabItem>
            <TabItem Header="Request Body">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="5">
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="#999999"/>
                        <TextBox x:Name="RequestBodySearchBox" Width="200" Style="{StaticResource SearchBoxStyle}" TextChanged="SearchBox_TextChanged"/>
                        <TextBlock x:Name="RequestBodySearchResult" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="#999999"/>
                    </StackPanel>
                    <TextBox x:Name="RequestBodyBox" Style="{StaticResource DetailTextBoxStyle}"/>
                </DockPanel>
            </TabItem>
            <TabItem Header="Response Headers">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="5">
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="#999999"/>
                        <TextBox x:Name="ResponseHeadersSearchBox" Width="200" Style="{StaticResource SearchBoxStyle}" TextChanged="SearchBox_TextChanged"/>
                        <TextBlock x:Name="ResponseHeadersSearchResult" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="#999999"/>
                    </StackPanel>
                    <TextBox x:Name="ResponseHeadersBox" Style="{StaticResource DetailTextBoxStyle}"/>
                </DockPanel>
            </TabItem>
            <TabItem Header="Response Body">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="5">
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="#999999"/>
                        <TextBox x:Name="ResponseBodySearchBox" Width="200" Style="{StaticResource SearchBoxStyle}" TextChanged="SearchBox_TextChanged"/>
                        <TextBlock x:Name="ResponseBodySearchResult" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="#999999"/>
                    </StackPanel>
                    <TextBox x:Name="ResponseBodyBox" Style="{StaticResource DetailTextBoxStyle}"/>
                </DockPanel>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
